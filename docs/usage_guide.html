<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage Guide &mdash; KFRE 0.1.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=00ee5977" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=8618f531"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=a0ccc04e"></script>
        <script src="_static/custom.js?v=fecc5f50"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Acknowledgements" href="acknowledgements.html" />
    <link rel="prev" title="Welcome to the KFRE Python Library Documentation!" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            KFRE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Welcome to the KFRE Python Library Documentation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#single-patient-risk-calculation">Single Patient Risk Calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kfre_person"><code class="docutils literal notranslate"><span class="pre">kfre_person()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#conversion-of-clinical-parameters">Conversion of Clinical Parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#upcr-to-uacr">uPCR to uACR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calcium">Calcium</a></li>
<li class="toctree-l2"><a class="reference internal" href="#phosphate">Phosphate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#albumin">Albumin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conversion-functions">Conversion Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#perform_conversions"><code class="docutils literal notranslate"><span class="pre">perform_conversions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#upcr_uacr"><code class="docutils literal notranslate"><span class="pre">upcr_uacr()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#classifying-esrd-outcomes">Classifying ESRD Outcomes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#class_esrd_outcome"><code class="docutils literal notranslate"><span class="pre">class_esrd_outcome()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#batch-risk-calculation-for-multiple-patients">Batch Risk Calculation for Multiple Patients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add_kfre_risk_col"><code class="docutils literal notranslate"><span class="pre">add_kfre_risk_col()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#performance-assessment">Performance Assessment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#auc-roc-precision-recall-curves">AUC ROC &amp; Precision-Recall Curves</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plot_kfre_metrics"><code class="docutils literal notranslate"><span class="pre">plot_kfre_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-metrics">Performance Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#eval_kfre_metrics"><code class="docutils literal notranslate"><span class="pre">eval_kfre_metrics()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About KFRE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citing KFRE</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">KFRE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Usage Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="no-click"><a class="reference internal image-reference" href="_images/kfre_logo.svg"><img alt="KFRE Library Logo" class="align-left" src="_images/kfre_logo.svg" width="200px" /></a>
</div><div style="height: 106px;"></div><p></p>
<section id="id1">
<h1>Usage Guide<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<p>This section provides guidance on using the KFRE library.</p>
</section>
<section id="single-patient-risk-calculation">
<h1>Single Patient Risk Calculation<a class="headerlink" href="#single-patient-risk-calculation" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">kfre</span></code> library offers a flexible and user-friendly interface to estimate the
risk of kidney failure for individual patients using Tangri’s KFRE model. With
<code class="docutils literal notranslate"><span class="pre">kfre</span></code>, you can calculate the risk using the classic 4-variable model, the
detailed 8-variable model, and, uniquely, a 6-variable model that is not commonly
found in online calculators.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">kfre_person</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="kfre_person">
<span class="sig-name descname"><span class="pre">kfre_person</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">age</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_male</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eGFR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uACR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_north_american</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">years</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">htn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">albumin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phosphorous</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bicarbonate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calcium</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kfre_person" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>age</strong> – Age of the patient.</p></li>
<li><p><strong>is_male</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if the patient is male, <code class="docutils literal notranslate"><span class="pre">False</span></code> if female.</p></li>
<li><p><strong>eGFR</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – Estimated Glomerular Filtration Rate.</p></li>
<li><p><strong>uACR</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – Urinary Albumin to Creatinine Ratio.</p></li>
<li><p><strong>is_north_american</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if the patient is from North America, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p></li>
<li><p><strong>years</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Time horizon for the risk prediction (default is 2 years).</p></li>
<li><p><strong>dm</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Diabetes mellitus indicator. <code class="docutils literal notranslate"><span class="pre">(1=yes;</span> <span class="pre">0=no).</span></code></p></li>
<li><p><strong>htn</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Hypertension indicator. <code class="docutils literal notranslate"><span class="pre">(1=yes;</span> <span class="pre">0=no).</span></code></p></li>
<li><p><strong>albumin</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Serum albumin level.</p></li>
<li><p><strong>phosphorous</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Serum phosphorous level.</p></li>
<li><p><strong>bicarbonate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Serum bicarbonate level.</p></li>
<li><p><strong>calcium</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><em>float</em></a>) – (<cite>optional</cite>) Serum calcium level.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">float</span></code>: The risk of developing CKD within the specified timeframe, as a decimal. Multiply by 100 to convert to a percentage.</p>
</dd>
</dl>
</dd></dl>

<p><strong>Description</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">kfre_person</span></code> function allows for detailed, personalized risk assessments
based on a range of clinical parameters. Depending on the completeness of the
data provided, the function can apply a basic 4-variable model or more
comprehensive models incorporating additional risk factors like diabetes,
hypertension, and various biochemical markers.</p>
<p>The function is designed for ease of use in clinical settings or research,
providing immediate risk estimations that are crucial for patient management or
further analysis.</p>
<p><strong>Example Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">risk_percentage</span> <span class="o">=</span> <span class="n">kfre_person</span><span class="p">(</span>
    <span class="n">age</span><span class="o">=</span><span class="mf">57.28</span><span class="p">,</span>
    <span class="n">is_male</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">eGFR</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
    <span class="n">uACR</span><span class="o">=</span><span class="mf">1762.001840</span><span class="p">,</span>
    <span class="n">is_north_american</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">years</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">dm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">htn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">albumin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">phosphorous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bicarbonate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">calcium</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># Convert to percentage</span>

<span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The 2-year risk of kidney failure for this patient is&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">risk_percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span><span class="m">2</span>-year<span class="w"> </span>risk<span class="w"> </span>of<span class="w"> </span>kidney<span class="w"> </span>failure<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>patient<span class="w"> </span>is<span class="w"> </span><span class="m">44</span>.66%.
</pre></div>
</div>
<p><strong>Example Calculation for 2-year and 5-year Risk</strong></p>
<p>Here’s how to estimate the 2-year and 5-year kidney failure risk for a
hypothetical 57.28-year-old female who is not from North America and has
specific clinical characteristics.</p>
<p>Ensure to:</p>
<ul class="simple">
<li><p>Uncomment <code class="docutils literal notranslate"><span class="pre">dm</span></code> and <code class="docutils literal notranslate"><span class="pre">htn</span></code> if you are using the 6-variable KFRE model.</p></li>
<li><p>For the 8-variable KFRE, keep <code class="docutils literal notranslate"><span class="pre">dm</span></code> and <code class="docutils literal notranslate"><span class="pre">htn</span></code> commented out and instead, uncomment the <code class="docutils literal notranslate"><span class="pre">albumin</span></code>, <code class="docutils literal notranslate"><span class="pre">phosphorous</span></code>, <code class="docutils literal notranslate"><span class="pre">bicarbonate</span></code>, and <code class="docutils literal notranslate"><span class="pre">calcium</span></code> variables.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">years</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="n">risk_percentage</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">kfre_person</span><span class="p">(</span>
            <span class="n">age</span><span class="o">=</span><span class="mf">57.28</span><span class="p">,</span>
            <span class="n">is_male</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># is the patient male?</span>
            <span class="n">eGFR</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>  <span class="c1"># ml/min/1.73 m^2</span>
            <span class="n">uACR</span><span class="o">=</span><span class="mf">1762.001840</span><span class="p">,</span>  <span class="c1"># mg/g</span>
            <span class="n">is_north_american</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># is the patient from North America?</span>
            <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
            <span class="c1">################################################################</span>
            <span class="c1"># Uncomment &quot;dm&quot; and &quot;htn&quot; for the 6-variable model:</span>
            <span class="c1">################################################################</span>
            <span class="c1"># dm=0,</span>
            <span class="c1"># htn=1,</span>
            <span class="c1">################################################################</span>
            <span class="c1"># Comment out &quot;dm&quot; and &quot;htn&quot;; uncomment the following lines for</span>
            <span class="c1"># the 8-variable model:</span>
            <span class="c1">################################################################</span>
            <span class="c1"># albumin=3.0, # g/dL</span>
            <span class="c1"># phosphorous=3.162, # mg/dL</span>
            <span class="c1"># bicarbonate=21.3, # mEq/L</span>
            <span class="c1"># calcium=9.72, # mg/dL</span>
        <span class="p">)</span>
        <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># multiply by 100 to convert to percentage</span>
    <span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">years</span><span class="si">}</span><span class="s2">-year risk of kidney failure for this patient is&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">risk_percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The<span class="w"> </span><span class="m">2</span>-year<span class="w"> </span>risk<span class="w"> </span>of<span class="w"> </span>kidney<span class="w"> </span>failure<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>patient<span class="w"> </span>is<span class="w"> </span><span class="m">44</span>.66%.
The<span class="w"> </span><span class="m">5</span>-year<span class="w"> </span>risk<span class="w"> </span>of<span class="w"> </span>kidney<span class="w"> </span>failure<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>patient<span class="w"> </span>is<span class="w"> </span><span class="m">89</span>.89%.
</pre></div>
</div>
</section>
<section id="conversion-of-clinical-parameters">
<h1>Conversion of Clinical Parameters<a class="headerlink" href="#conversion-of-clinical-parameters" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">kfre</span></code> library includes a utility function <code class="docutils literal notranslate"><span class="pre">perform_conversions</span></code>
designed to convert clinical measurement units. This function is especially
useful when preparing data for analyses that require specific units. It can
handle conversions for multiple parameters, such as urinary protein-creatinine
ratio (uPCR), calcium, phosphate, and albumin levels.</p>
<p><strong>Key Features</strong></p>
<ul class="simple">
<li><p><strong>Flexible Conversion:</strong> The function supports both standard and reverse conversions, allowing users to switch between units as needed.</p></li>
<li><p><strong>Batch Processing:</strong> It can process entire columns of data, making it suitable for datasets with multiple patients.</p></li>
<li><p><strong>Custom Column Names:</strong> Users can specify which columns to convert, providing flexibility in handling datasets with varied naming conventions.</p></li>
</ul>
<section id="upcr-to-uacr">
<h2>uPCR to uACR<a class="headerlink" href="#upcr-to-uacr" title="Link to this heading"></a></h2>
<p>The conversion of uPCR from mg/mmol to mg/g involves understanding that both
mg/mmol and mg/g are ratios that can be related through their units.</p>
<ul class="simple">
<li><p>mg/mmol is a ratio of mass (in milligrams) to molar concentration (in millimoles), while</p></li>
<li><p>mg/g is a ratio of mass (in milligrams) to mass (in grams).</p></li>
</ul>
<p>To convert mg/mmol to mg/g, we need to know the molar mass of creatinine,
because uPCR is the ratio of the mass of protein to the mass of creatinine.
The molar mass of creatinine is approximately 113.12 g/mol. Therefore, 1 mmol of
creatinine is 113.12 mg.</p>
<p>Here’s the conversion:</p>
<p>1 mg/mmol means that you have 1 mg of protein for every 1 mmol of creatinine.
Since 1 mmol of creatinine is 113.12 mg:</p>
<div class="math notranslate nohighlight">
\[\frac{\text{1 mg protein}}{\text{0.11312 g creatinine}} \approx 8.84  {\text{ mg/g}}\]</div>
</section>
<section id="calcium">
<h2>Calcium<a class="headerlink" href="#calcium" title="Link to this heading"></a></h2>
<p>Calcium is often measured in millimoles per liter (mmol/L) and needs to be
converted to milligrams per deciliter (mg/dL) for certain clinical applications
or study comparisons.
- Molecular weight of Calcium (Ca): Calcium’s atomic weight is approximately 40.08 g/mol.
- Conversion factor: To convert mmol/L to mg/dL for calcium, you multiply by 4.
This is derived as follows:</p>
<div class="math notranslate nohighlight">
\[\text{1 mmol/L} \times  \frac{\text{40.08 mg}}{{\text{1 mmol}}} \times \frac{\text {1L} } {\text{10 dL}} = 4.008 \text{ mg/dL}\]</div>
</section>
<section id="phosphate">
<h2>Phosphate<a class="headerlink" href="#phosphate" title="Link to this heading"></a></h2>
<p>Phosphate concentrations are similarly reported in mmol/L but often need to be expressed in mg/dL.</p>
<ul class="simple">
<li><p>Molecular weight of Phosphate (PO₄³⁻): The molar mass of phosphate as an ion (considering phosphorus and oxygen) is approximately 94.97 g/mol.</p></li>
<li><p>Conversion factor: To convert mmol/L to mg/dL for phosphate:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\text{1 mmol/L} \times  \frac{\text{94.97 mg}}{{\text{1 mmol}}} \times \frac{\text {1L} } {\text{10 dL}} \approx 9.497 \text{ mg/dL}\]</div>
</section>
<section id="albumin">
<h2>Albumin<a class="headerlink" href="#albumin" title="Link to this heading"></a></h2>
<p>Albumin measurements are often made in grams per liter (g/L) and converted to
grams per deciliter (g/dL) for standard reporting in many clinical contexts.</p>
<p>Conversion factor: Converting g/L to g/dL is straightforward as it involves
shifting the decimal point:</p>
<div class="math notranslate nohighlight">
\[1\text{ g/L} \div 10 = 0.1 \text { g/dL}\]</div>
<p>These conversions help ensure consistency in reporting and interpreting lab
values across different systems and studies, facilitating better comparison and
understanding of patient data.</p>
</section>
<section id="conversion-functions">
<h2>Conversion Functions<a class="headerlink" href="#conversion-functions" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="perform_conversions">
<span class="sig-name descname"><span class="pre">perform_conversions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upcr_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calcium_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">albumin_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">convert_all</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#perform_conversions" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – The DataFrame containing the data that needs unit conversion. This DataFrame should include columns that contain measurements in either original units or units that need conversion according to specified clinical or scientific standards.</p></li>
<li><p><strong>reverse</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) Determines the direction of the conversion. If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the function will convert units from a converted state back to the original state (e.g., from mmol/L back to mg/dL). If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the function performs the standard conversion from original to new units (e.g., from mg/dL to mmol/L). Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>convert_all</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the function attempts to automatically identify and convert all recognized columns based on standard medical or chemical units present in the DataFrame. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the function will only convert the columns explicitly specified by the other parameters (e.g., upcr_col, calcium_col). Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>upcr_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Specifies the column name for urine protein-creatinine ratio (uPCR) in the DataFrame, which often needs conversion between mg/g and mmol/L for clinical assessments. If provided, this column will be converted according to the specified <code class="docutils literal notranslate"><span class="pre">reverse</span></code> flag.</p></li>
<li><p><strong>calcium_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Specifies the column name for calcium measurements in the DataFrame. This parameter allows the conversion between common units of calcium concentration, enhancing comparability across different data sets or aligning with specific analysis requirements.</p></li>
<li><p><strong>phosphate_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Specifies the column name for phosphate measurements in the DataFrame. Similar to <code class="docutils literal notranslate"><span class="pre">calcium_col</span></code>, this parameter enables unit conversion for phosphate levels, important for biochemical and clinical assessments.</p></li>
<li><p><strong>albumin_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Specifies the column name for albumin measurements. Albumin, often measured in different units across various medical tests, can be converted using this parameter to standardize the data for analysis or reporting purposes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>These parameters provide the flexibility to tailor the unit conversion process to specific data needs, enabling precise and appropriate conversions crucial for accurate data analysis and interpretation in clinical or scientific research.</p>
<p><strong>Example Usage</strong></p>
<p>The following is an example to illustrate the usage of the <code class="docutils literal notranslate"><span class="pre">perform_conversions</span></code> function. This example shows how to convert values from mmol to mg for various clinical parameters within a DataFrame.</p>
<p><cite>First 5 Rows of Biochemical Data (Adapted from Ali et al., 2021, BMC Nephrol)</cite> <a class="footnote-reference brackets" href="#id6" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>uPCR</p></th>
<th class="head"><p>Calcium (mmol/L)</p></th>
<th class="head"><p>Albumin (g/l)</p></th>
<th class="head"><p>Phosphate (mmol/L)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>33.0</p></td>
<td><p>2.78</p></td>
<td><p>37.0</p></td>
<td><p>0.88</p></td>
</tr>
<tr class="row-odd"><td><p>395.0</p></td>
<td><p>2.43</p></td>
<td><p>30.0</p></td>
<td><p>1.02</p></td>
</tr>
<tr class="row-even"><td><p>163.0</p></td>
<td><p>2.33</p></td>
<td><p>36.0</p></td>
<td><p>1.24</p></td>
</tr>
<tr class="row-odd"><td><p>250.0</p></td>
<td><p>2.29</p></td>
<td><p>39.0</p></td>
<td><p>1.80</p></td>
</tr>
<tr class="row-even"><td><p>217.0</p></td>
<td><p>2.45</p></td>
<td><p>43.0</p></td>
<td><p>1.39</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">perform_conversions</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform conversions using the wrapper function, specifying all parameters</span>
<span class="c1"># and specify new column names</span>
<span class="n">converted_df</span> <span class="o">=</span> <span class="n">perform_conversions</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">upcr_col</span><span class="o">=</span><span class="s2">&quot;uPCR (mmol)&quot;</span><span class="p">,</span>
    <span class="n">calcium_col</span><span class="o">=</span><span class="s2">&quot;Calcium&quot;</span><span class="p">,</span>
    <span class="n">albumin_col</span><span class="o">=</span><span class="s2">&quot;Albumin&quot;</span><span class="p">,</span>
    <span class="n">convert_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print the DataFrame to see the changes</span>
<span class="n">converted_df</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Converted<span class="w"> </span><span class="s1">&#39;uPCR&#39;</span><span class="w"> </span>to<span class="w"> </span>new<span class="w"> </span>column<span class="w"> </span><span class="s1">&#39;uPCR_mg_g&#39;</span><span class="w"> </span>with<span class="w"> </span>factor<span class="w"> </span><span class="m">8</span>.84016973125884
Converted<span class="w"> </span><span class="s1">&#39;Calcium (mmol/L)&#39;</span><span class="w"> </span>to<span class="w"> </span>new<span class="w"> </span>column<span class="w"> </span><span class="s1">&#39;Calcium_mg_dl&#39;</span><span class="w"> </span>with<span class="w"> </span>factor<span class="w"> </span><span class="m">4</span>
Converted<span class="w"> </span><span class="s1">&#39;Phosphate (mmol/L)&#39;</span><span class="w"> </span>to<span class="w"> </span>new<span class="w"> </span>column<span class="w"> </span><span class="s1">&#39;Phosphate_mg_dl&#39;</span><span class="w"> </span>with<span class="w"> </span>factor<span class="w"> </span><span class="m">3</span>.1
Converted<span class="w"> </span><span class="s1">&#39;Albumin (g/l)&#39;</span><span class="w"> </span>to<span class="w"> </span>new<span class="w"> </span>column<span class="w"> </span><span class="s1">&#39;Albumin_g_dl&#39;</span><span class="w"> </span>with<span class="w"> </span>factor<span class="w"> </span><span class="m">0</span>.1
</pre></div>
</div>
<p><cite>First 5 Rows of Biochemical Data with Conversions (Adapted from Ali et al., 2021, BMC Nephrol)</cite> <a class="footnote-reference brackets" href="#id6" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>uPCR</p></th>
<th class="head"><p>Calcium (mmol/L)</p></th>
<th class="head"><p>Albumin (g/l)</p></th>
<th class="head"><p>Phosphate (mmol/L)</p></th>
<th class="head"><p>uPCR_mg_g</p></th>
<th class="head"><p>Calcium_mg_dl</p></th>
<th class="head"><p>Phosphate_mg_dl</p></th>
<th class="head"><p>Albumin_g_dl</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>33.0</p></td>
<td><p>2.78</p></td>
<td><p>37.0</p></td>
<td><p>0.88</p></td>
<td><p>291.725601</p></td>
<td><p>11.12</p></td>
<td><p>2.728</p></td>
<td><p>3.7</p></td>
</tr>
<tr class="row-odd"><td><p>395.0</p></td>
<td><p>2.43</p></td>
<td><p>30.0</p></td>
<td><p>1.02</p></td>
<td><p>3491.867044</p></td>
<td><p>9.72</p></td>
<td><p>3.162</p></td>
<td><p>3.0</p></td>
</tr>
<tr class="row-even"><td><p>163.0</p></td>
<td><p>2.33</p></td>
<td><p>36.0</p></td>
<td><p>1.24</p></td>
<td><p>1440.947666</p></td>
<td><p>9.32</p></td>
<td><p>3.844</p></td>
<td><p>3.6</p></td>
</tr>
<tr class="row-odd"><td><p>250.0</p></td>
<td><p>2.29</p></td>
<td><p>39.0</p></td>
<td><p>1.80</p></td>
<td><p>2210.042433</p></td>
<td><p>9.16</p></td>
<td><p>5.580</p></td>
<td><p>3.9</p></td>
</tr>
<tr class="row-even"><td><p>217.0</p></td>
<td><p>2.45</p></td>
<td><p>43.0</p></td>
<td><p>1.39</p></td>
<td><p>1918.316832</p></td>
<td><p>9.80</p></td>
<td><p>4.309</p></td>
<td><p>4.3</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="upcr_uacr">
<span class="sig-name descname"><span class="pre">upcr_uacr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sex_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diabetes_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hypertension_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upcr_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">female_str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#upcr_uacr" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – This parameter should be a pandas DataFrame containing the patient data. The DataFrame needs to include specific columns that will be referenced by the other parameters in the function for the conversion process.</p></li>
<li><p><strong>sex_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The name of the column in the DataFrame that identifies the patient’s sex. This is used to apply gender-specific adjustments in the conversion formula, as biological sex can influence the levels of urinary protein and albumin.</p></li>
<li><p><strong>diabetes_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The name of the column that indicates whether the patient has diabetes, typically marked as <code class="docutils literal notranslate"><span class="pre">1</span></code> for <code class="docutils literal notranslate"><span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> for <code class="docutils literal notranslate"><span class="pre">no</span></code>. Diabetes status is used to adjust the conversion because diabetes can impact kidney function and alter protein and albumin excretion rates.</p></li>
<li><p><strong>hypertension_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The name of the column that shows whether the patient has hypertension, also typically marked as <code class="docutils literal notranslate"><span class="pre">1</span></code> for <code class="docutils literal notranslate"><span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> for <code class="docutils literal notranslate"><span class="pre">no</span></code>. Hypertension can affect kidney function, making it a necessary factor in the conversion calculations.</p></li>
<li><p><strong>upcr_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The name of the column containing the urinary protein-creatinine ratio (uPCR) values that need to be converted to urinary albumin-creatinine ratio (uACR). This is the primary input for the conversion process.</p></li>
<li><p><strong>female_str</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The string used in the dataset to identify female patients. This string is crucial for applying the correct conversion factors, as the function adjusts differently based on the patient being male or female, reflecting the biological differences in albumin excretion.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">pd.Series</span></code>: The function returns a pandas Series containing the computed urinary albumin-creatinine ratio (uACR) for each patient in the DataFrame. This Series is indexed in the same way as the original DataFrame (<code class="docutils literal notranslate"><span class="pre">df.index</span></code>), ensuring that the uACR values align correctly with the corresponding patient data.</p>
</dd>
</dl>
</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">upcr_uacr</span></code> function is typically used in clinical data processing where accurate assessment of kidney function is critical. By converting uPCR to uACR, clinicians can get a more precise evaluation of albuminuria, which is important for diagnosing and monitoring kidney diseases. This function allows for a standardized approach to handling variations in patient characteristics that might affect urinary albumin levels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;uACR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">upcr_uacr</span><span class="p">(</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<span class="n">sex_col</span><span class="o">=</span><span class="s2">&quot;SEX&quot;</span><span class="p">,</span>
<span class="n">diabetes_col</span><span class="o">=</span><span class="s2">&quot;Diabetes (1=yes; 0=no)&quot;</span><span class="p">,</span>
<span class="n">hypertension_col</span><span class="o">=</span><span class="s2">&quot;Hypertension (1=yes; 0=no)&quot;</span><span class="p">,</span>
<span class="n">upcr_col</span><span class="o">=</span><span class="s2">&quot;uPCR_mg_g&quot;</span><span class="p">,</span>
<span class="n">female_str</span><span class="o">=</span><span class="s2">&quot;Female&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;uACR&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span>       <span class="mf">102.438624</span>
<span class="mi">1</span>      <span class="mf">1762.039423</span>
<span class="mi">2</span>       <span class="mf">659.136129</span>
<span class="mi">3</span>      <span class="mf">1145.245058</span>
<span class="mi">4</span>       <span class="mf">980.939665</span>
        <span class="o">...</span>
<span class="mi">740</span>    <span class="mf">3462.801185</span>
<span class="mi">741</span>    <span class="mf">5977.278911</span>
<span class="mi">742</span>    <span class="mf">3787.896473</span>
<span class="mi">743</span>            <span class="n">NaN</span>
<span class="mi">744</span>            <span class="n">NaN</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">uACR</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">745</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</section>
</section>
<section id="classifying-esrd-outcomes">
<h1>Classifying ESRD Outcomes<a class="headerlink" href="#classifying-esrd-outcomes" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">class_esrd_outcome</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="class_esrd_outcome">
<span class="sig-name descname"><span class="pre">class_esrd_outcome</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">years</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_years_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#class_esrd_outcome" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – The DataFrame to perform calculations on. This DataFrame should include columns relevant for calculating ESRD outcomes.</p></li>
<li><p><strong>col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The column name with ESRD (should be eGFR &lt; 15 flag).</p></li>
<li><p><strong>years</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – The number of years to use in the condition.</p></li>
<li><p><strong>duration_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The name of the column containing the duration data.</p></li>
<li><p><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Custom prefix for the new column name. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no prefix is added.</p></li>
<li><p><strong>create_years_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) Whether to create the ‘years’ column. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code>: The modified DataFrame with the new column added.</p>
</dd>
</dl>
</dd></dl>

<p>This function creates a new column in the DataFrame which is populated with a <code class="docutils literal notranslate"><span class="pre">1</span></code> or a <code class="docutils literal notranslate"><span class="pre">0</span></code> based on whether the ESRD condition (eGFR &lt; 15) is met within the specified number of years. If <code class="docutils literal notranslate"><span class="pre">create_years_col</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, it calculates the ‘years’ column based on the <code class="docutils literal notranslate"><span class="pre">duration_col</span></code> provided. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, it uses the <code class="docutils literal notranslate"><span class="pre">duration_col</span></code> directly. The new column is named using the specified prefix and number of years, or just the number of years if no prefix is provided.</p>
<p><strong>Example Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">class_esrd_outcome</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2-year outcome</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">class_esrd_outcome</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;ESRD&quot;</span><span class="p">,</span>
    <span class="n">years</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s2">&quot;Follow-up YEARS&quot;</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">create_years_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># 5-year outcome</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">class_esrd_outcome</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">col</span><span class="o">=</span><span class="s2">&quot;ESRD&quot;</span><span class="p">,</span>
    <span class="n">years</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">duration_col</span><span class="o">=</span><span class="s2">&quot;Follow-up YEARS&quot;</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">create_years_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><cite>First 5 Rows of Outcome Data (Adapted from Ali et al., 2021, BMC Nephrol)</cite> <a class="footnote-reference brackets" href="#id6" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>2_year_outcome</p></th>
<th class="head"><p>5_year_outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</section>
<section id="batch-risk-calculation-for-multiple-patients">
<h1>Batch Risk Calculation for Multiple Patients<a class="headerlink" href="#batch-risk-calculation-for-multiple-patients" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">kfre</span></code> library provides the functionality to perform batch processing of
patient data, allowing for the computation of kidney failure risk predictions
across multiple patients in a single operation. This capability is especially
valuable for researchers and clinicians needing to assess risks for large cohorts
or patient groups.</p>
<p><strong>Key Features</strong></p>
<p>When using the <code class="docutils literal notranslate"><span class="pre">add_kfre_risk_col</span></code> function, the library will append new columns
for each specified variable model (4-variable, 6-variable, 8-variable) and each
time frame (2 years, 5 years) directly to the original DataFrame. This facilitates
a seamless integration of risk predictions into existing patient datasets without
the need for additional data manipulation steps.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">kfre</span></code> library is designed to facilitate risk prediction using Tangri’s KFRE
model based on a given set of patient data. It is crucial to ensure that all
patient data within a batch calculation are consistent in terms of regional
categorization—that is, either all North American or all non-North American. To
this end, it is crucial to ensure that all patient data within a batch calculation
are consistent in terms of regional categorization. Mixing patient data from
different regions within a single batch is not supported, as the function is set
to apply one regional coefficient set at a time. This approach ensures the accuracy
and reliability of the risk predictions.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">add_kfre_risk_col</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="add_kfre_risk_col">
<span class="sig-name descname"><span class="pre">add_kfre_risk_col</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">age_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sex_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eGFR_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uACR_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dm_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">htn_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">albumin_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phosphorous_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bicarbonate_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calcium_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">years</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_north_american</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#add_kfre_risk_col" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – The DataFrame containing the patient data. This DataFrame should include columns for patient-specific parameters that are relevant for calculating kidney failure risk.</p></li>
<li><p><strong>age_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The column name in df that contains the patient’s age. Age is a required parameter for all models (4-variable, 6-variable, 8-variable).</p></li>
<li><p><strong>sex_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The column name in df that contains the patient’s age. Age is a required parameter for all models (4-variable, 6-variable, 8-variable).</p></li>
<li><p><strong>eGFR_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The column name for estimated Glomerular Filtration Rate (eGFR), which is a crucial measure of kidney function. This parameter is essential for all models.</p></li>
<li><p><strong>uACR_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – The column name for urinary Albumin-Creatinine Ratio (uACR), indicating kidney damage level. This parameter is included in all model calculations.</p></li>
<li><p><strong>dm_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) The column name for indicating the presence of diabetes mellitus (<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">=</span> <span class="pre">yes,</span> <span class="pre">0</span> <span class="pre">=</span> <span class="pre">no</span></code>). This parameter is necessary for the 6-variable and 8-variable models.</p></li>
<li><p><strong>htn_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) The column name for indicating the presence of diabetes mellitus (<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">=</span> <span class="pre">yes,</span> <span class="pre">0</span> <span class="pre">=</span> <span class="pre">no</span></code>). This parameter is necessary for the 6-variable and 8-variable models.</p></li>
<li><p><strong>albumin_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) The column name for serum albumin levels, which are included in the 8-variable model. Serum albumin is a protein in the blood that can indicate health issues including kidney function.</p></li>
<li><p><strong>phosphorous_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) The column name for serum phosphorus levels. This parameter is part of the 8-variable model and is important for assessing kidney health.</p></li>
<li><p><strong>calcium_col</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) The column name for serum calcium levels. This parameter is included in the 8-variable model and is crucial for assessing overall metabolic functions and kidney health.</p></li>
<li><p><strong>num_vars</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a>) – Specifies the number of variables to be used in the model (options: <code class="docutils literal notranslate"><span class="pre">4</span></code>, <code class="docutils literal notranslate"><span class="pre">6</span></code>, <code class="docutils literal notranslate"><span class="pre">8</span></code>). This determines which variables must be provided and which risk model is applied.</p></li>
<li><p><strong>years</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><em>tuple</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a>) – Time frames for which to calculate the risk, typically provided as a tuple or list (e.g., (<code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">5</span></code>)). This parameter specifies over how many years the kidney failure risk is projected.</p></li>
<li><p><strong>is_north_american</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – Specifies whether the calculations should use coefficients adjusted for North American populations. Different geographical regions may have different risk profiles due to genetic, environmental, and healthcare-related differences.</p></li>
<li><p><strong>copy</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the function operates on a copy of the DataFrame, thereby preserving the original data. If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, it modifies the DataFrame in place.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code>: The modified DataFrame with new columns added for each model and time frame specified. Columns are named following the pattern <code class="docutils literal notranslate"><span class="pre">pred_{model_var}var_{year}year</span></code>, where <code class="docutils literal notranslate"><span class="pre">{model_var}</span></code> is the number of variables (<code class="docutils literal notranslate"><span class="pre">4</span></code>,  <code class="docutils literal notranslate"><span class="pre">6</span></code>, or <code class="docutils literal notranslate"><span class="pre">8</span></code>) and <code class="docutils literal notranslate"><span class="pre">{year}</span></code> is the time frame (<code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">5</span></code>).</p>
</dd>
</dl>
</dd></dl>

<p>This function is designed to compute the risk of chronic kidney disease (CKD) over specified or all possible models and time frames, directly appending the results as new columns to the provided DataFrame. It organizes the results by model (4-variable, 6-variable, 8-variable) first, followed by the time frame (2 years, 5 years) for each model type.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sex_col</span></code> must contain strings (case-insensitive) indicating either <cite>female</cite> or <cite>male</cite>.</p>
</div>
<p><strong>Example Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">add_kfre_risk_col</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">age_col</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">sex_col</span><span class="o">=</span><span class="s2">&quot;SEX&quot;</span><span class="p">,</span>
    <span class="n">eGFR_col</span><span class="o">=</span><span class="s2">&quot;eGFR-EPI&quot;</span><span class="p">,</span>
    <span class="n">uACR_col</span><span class="o">=</span><span class="s2">&quot;uACR&quot;</span><span class="p">,</span>
    <span class="n">dm_col</span><span class="o">=</span><span class="s2">&quot;Diabetes (1=yes; 0=no)&quot;</span><span class="p">,</span>
    <span class="n">htn_col</span><span class="o">=</span><span class="s2">&quot;Hypertension (1=yes; 0=no)&quot;</span><span class="p">,</span>
    <span class="n">albumin_col</span><span class="o">=</span><span class="s2">&quot;Albumin_g_dl&quot;</span><span class="p">,</span>
    <span class="n">phosphorous_col</span><span class="o">=</span><span class="s2">&quot;Phosphate_mg_dl&quot;</span><span class="p">,</span>
    <span class="n">bicarbonate_col</span><span class="o">=</span><span class="s2">&quot;Bicarbonate (mmol/L)&quot;</span><span class="p">,</span>
    <span class="n">calcium_col</span><span class="o">=</span><span class="s2">&quot;Calcium_mg_dl&quot;</span><span class="p">,</span>
    <span class="n">num_vars</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">years</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">is_north_american</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Modify the original DataFrame directly</span>
<span class="p">)</span>
<span class="c1"># The resulting DataFrame &#39;df&#39; now includes new columns with risk</span>
<span class="c1"># predictions for each model and time frame</span>
</pre></div>
</div>
<p><cite>First 5 Rows of Kidney Failure Risk Data (Adapted from Ali et al., 2021, BMC Nephrol)</cite> <a class="footnote-reference brackets" href="#id6" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Age</p></th>
<th class="head"><p>SEX</p></th>
<th class="head"><p>Diabetes (1=yes; 0=no)</p></th>
<th class="head"><p>Hypertension (1=yes; 0=no)</p></th>
<th class="head"><p>eGFR-EPI</p></th>
<th class="head"><p>uACR</p></th>
<th class="head"><p>2_year_outcome</p></th>
<th class="head"><p>5_year_outcome</p></th>
<th class="head"><p>kfre_4var_2year</p></th>
<th class="head"><p>kfre_4var_5year</p></th>
<th class="head"><p>kfre_6var_2year</p></th>
<th class="head"><p>kfre_6var_5year</p></th>
<th class="head"><p>kfre_8var_2year</p></th>
<th class="head"><p>kfre_8var_5year</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>87.24</p></td>
<td><p>Male</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>19.0</p></td>
<td><p>5.744563</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0.018785</p></td>
<td><p>0.070800</p></td>
<td><p>0.017622</p></td>
<td><p>0.065247</p></td>
<td><p>0.011139</p></td>
<td><p>0.049138</p></td>
</tr>
<tr class="row-odd"><td><p>56.88</p></td>
<td><p>Female</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>15.0</p></td>
<td><p>140.661958</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0.173785</p></td>
<td><p>0.522508</p></td>
<td><p>0.189202</p></td>
<td><p>0.548860</p></td>
<td><p>0.209930</p></td>
<td><p>0.641537</p></td>
</tr>
<tr class="row-even"><td><p>66.53</p></td>
<td><p>Female</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>17.0</p></td>
<td><p>35.224504</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0.226029</p></td>
<td><p>0.064027</p></td>
<td><p>0.069593</p></td>
<td><p>0.239481</p></td>
<td><p>0.061889</p></td>
<td><p>0.249777</p></td>
</tr>
<tr class="row-odd"><td><p>69.92</p></td>
<td><p>Male</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>12.0</p></td>
<td><p>74.299919</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0.524577</p></td>
<td><p>0.174712</p></td>
<td><p>0.190458</p></td>
<td><p>0.551506</p></td>
<td><p>0.305670</p></td>
<td><p>0.806220</p></td>
</tr>
<tr class="row-even"><td><p>81.14</p></td>
<td><p>Female</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>15.0</p></td>
<td><p>59.683881</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0.255029</p></td>
<td><p>0.073213</p></td>
<td><p>0.068968</p></td>
<td><p>0.237542</p></td>
<td><p>0.060353</p></td>
<td><p>0.244235</p></td>
</tr>
</tbody>
</table>
</section>
<section id="performance-assessment">
<h1>Performance Assessment<a class="headerlink" href="#performance-assessment" title="Link to this heading"></a></h1>
<section id="auc-roc-precision-recall-curves">
<h2>AUC ROC &amp; Precision-Recall Curves<a class="headerlink" href="#auc-roc-precision-recall-curves" title="Link to this heading"></a></h2>
<div class="no-click"><a class="reference internal image-reference" href="_images/performance_grid.svg"><img alt="AUC_ROC_and_Precision_Recall" class="align-left" src="_images/performance_grid.svg" width="900px" /></a>
</div><div style="height: 106px;"></div><p></p>
<dl class="py function">
<dt class="sig sig-object py" id="plot_kfre_metrics">
<span class="sig-name descname"><span class="pre">plot_kfre_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(12,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_path_png</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_path_svg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bbox_inches</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tight'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all_plots'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_years</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_combinations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_grids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_places</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#plot_kfre_metrics" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – The input DataFrame containing the necessary columns for truth and predictions.</p></li>
<li><p><strong>num_vars</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><em>tuple</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – Number of variables (e.g., <code class="docutils literal notranslate"><span class="pre">4</span></code>) or a list/tuple of numbers of variables (e.g., <code class="docutils literal notranslate"><span class="pre">[4,</span> <span class="pre">6,</span> <span class="pre">8]</span></code>) to generate predictions for.</p></li>
<li><p><strong>fig_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><em>tuple</em></a>) – (<cite>optional</cite>) Size of the figure for the ROC plot, default is <code class="docutils literal notranslate"><span class="pre">(12,</span> <span class="pre">6)</span></code>.</p></li>
<li><p><strong>mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Operation mode, can be <code class="docutils literal notranslate"><span class="pre">'prep'</span></code>, <code class="docutils literal notranslate"><span class="pre">'plot'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'both'</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">'both'</span></code>. <code class="docutils literal notranslate"><span class="pre">'prep'</span></code> only prepares the metrics, <code class="docutils literal notranslate"><span class="pre">'plot'</span></code> only plots the metrics (requires pre-prepped metrics), <code class="docutils literal notranslate"><span class="pre">'both'</span></code> prepares and plots the metrics.</p></li>
<li><p><strong>image_path_png</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Path to save the PNG images. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>image_path_svg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Path to save the SVG images. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>image_prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Prefix to use for saved images. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>bbox_inches</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Bounding box in inches for the saved images. Default is <code class="docutils literal notranslate"><span class="pre">'tight'</span></code>.</p></li>
<li><p><strong>plot_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><em>str</em></a>) – (<cite>optional</cite>) Type of plot to generate, can be <code class="docutils literal notranslate"><span class="pre">'auc_roc'</span></code>, <code class="docutils literal notranslate"><span class="pre">'precision_recall'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'all_plots'</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">'all_plots'</span></code>.</p></li>
<li><p><strong>save_plots</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) Whether to save plots. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>show_years</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><em>tuple</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – (<cite>optional</cite>) Year outcomes to show in the plots. Default is <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">5]</span></code>.</p></li>
<li><p><strong>plot_combinations</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) Whether to plot all combinations of variables in a single plot. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>show_grids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><em>bool</em></a>) – (<cite>optional</cite>) Whether to show grid plots of all combinations. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>decimal_places</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – (<cite>optional</cite>) Number of decimal places for AUC and AP scores in the plot legends. Default is <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">tuple</span></code> (optional): Only returned if mode is ‘prep’ or ‘both’:
- y_true (list of pd.Series): True labels for specified year outcomes.
- preds (dict of list of pd.Series): Predicted probabilities for each number of variables and each outcome.
- outcomes (list of str): List of outcome labels.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">ValueError</span></code>: If <code class="docutils literal notranslate"><span class="pre">save_plots</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> without specifying <code class="docutils literal notranslate"><span class="pre">image_path_png</span></code> or <code class="docutils literal notranslate"><span class="pre">image_path_svg</span></code>.
If <code class="docutils literal notranslate"><span class="pre">bbox_inches</span></code> is not a string or <code class="docutils literal notranslate"><span class="pre">None</span></code>.
If <code class="docutils literal notranslate"><span class="pre">show_years</span></code> contains invalid year values.
If required KFRE probability columns are missing in the DataFrame.
If <code class="docutils literal notranslate"><span class="pre">plot_type</span></code> is not one of <code class="docutils literal notranslate"><span class="pre">'auc_roc'</span></code>, <code class="docutils literal notranslate"><span class="pre">'precision_recall'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'all_plots'</span></code>.</p>
</dd>
</dl>
</dd></dl>

<p>This function generates the true labels and predicted probabilities for 2-year and 5-year outcomes, and optionally plots and saves ROC and Precision-Recall curves for specified variable models. It can also save the plots as PNG or SVG files.</p>
<p><strong>Example usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">plot_kfre_metrics</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_kfre_metrics</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>                       <span class="c1"># DataFrame to produce plots for</span>
    <span class="n">num_vars</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>          <span class="c1"># 4,6,8 KFRE variables</span>
    <span class="n">fig_size</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>             <span class="c1"># Custom figure size</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span>                 <span class="c1"># Can be &#39;prep&#39;, &#39;plot&#39;, or &#39;both&#39;</span>
    <span class="n">image_prefix</span><span class="o">=</span><span class="s2">&quot;performance&quot;</span><span class="p">,</span>  <span class="c1"># Optional prefix for saved images</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>         <span class="c1"># Bounding box in inches for the saved images</span>
    <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;all_plots&quot;</span><span class="p">,</span>       <span class="c1"># Can be &#39;auc_roc&#39;, &#39;precision_recall&#39;, or &#39;all_plots&#39;</span>
    <span class="n">show_years</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>           <span class="c1"># Year outcomes to show in the plots</span>
    <span class="n">plot_combinations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># Plot combinations of all variables in one plot</span>
    <span class="n">show_grids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>             <span class="c1"># Place all plots on one grid; False does individual</span>
    <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>            <span class="c1"># Number of decimal places in legend</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="performance-metrics">
<h2>Performance Metrics<a class="headerlink" href="#performance-metrics" title="Link to this heading"></a></h2>
<p>This section explains the various performance metrics calculated by the <cite>eval_kfre_metrics</cite> function.</p>
<p><strong>Precision (Positive Predictive Value)</strong></p>
<p>Precision, also known as Positive Predictive Value (PPV), is the ratio of correctly predicted positive observations to the total predicted positives. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{Precision} = \frac{TP}{TP + FP}\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(TP\)</span> is the number of true positives.</p></li>
<li><p><span class="math notranslate nohighlight">\(FP\)</span> is the number of false positives.</p></li>
</ul>
</dd>
</dl>
<p><strong>Average Precision</strong></p>
<p>Average precision summarizes a precision-recall curve as the weighted mean of precisions achieved at each threshold, with the increase in recall from the previous threshold used as the weight. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{Average Precision} = \sum_n (R_n - R_{n-1}) P_n\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R_n\)</span> and <span class="math notranslate nohighlight">\(R_{n-1}\)</span> are the recall values at thresholds <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(n-1\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_n\)</span> is the precision at threshold <span class="math notranslate nohighlight">\(n\)</span>.</p></li>
</ul>
</dd>
</dl>
<p><strong>Sensitivity (Recall)</strong></p>
<p>Sensitivity, also known as Recall, is the ratio of correctly predicted positive observations to all observations in the actual class. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{Sensitivity} = \frac{TP}{TP + FN}\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(TP\)</span> is the number of true positives.</p></li>
<li><p><span class="math notranslate nohighlight">\(FN\)</span> is the number of false negatives.</p></li>
</ul>
</dd>
</dl>
<p><strong>Specificity</strong></p>
<p>Specificity measures the proportion of actual negatives that are correctly identified as such. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{Specificity} = \frac{TN}{TN + FP}\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(TN\)</span> is the number of true negatives.</p></li>
<li><p><span class="math notranslate nohighlight">\(FP\)</span> is the number of false positives.</p></li>
</ul>
</dd>
</dl>
<p><strong>AUC ROC (Area Under the Receiver Operating Characteristic Curve)</strong></p>
<p>AUC ROC is a performance measurement for classification problems at various threshold settings. ROC is a probability curve and AUC represents the degree or measure of separability. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{AUC} = \int_{0}^{1} TPR \, d(FPR)\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(TPR\)</span> is the true positive rate (sensitivity).</p></li>
<li><p><span class="math notranslate nohighlight">\(FPR\)</span> is the false positive rate (1 - specificity).</p></li>
</ul>
</dd>
</dl>
<p><strong>Brier Score</strong></p>
<p>Brier score measures the mean squared difference between the predicted probabilities and the actual binary outcomes. It is calculated as:</p>
<div class="math notranslate nohighlight">
\[\text{Brier Score} = \frac{1}{N} \sum_{i=1}^{N} (f_i - o_i)^2\]</div>
<dl class="simple">
<dt>Where:</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N\)</span> is the number of total observations.</p></li>
<li><p><span class="math notranslate nohighlight">\(f_i\)</span> is the predicted probability for the <span class="math notranslate nohighlight">\(i\)</span>-th observation.</p></li>
<li><p><span class="math notranslate nohighlight">\(o_i\)</span> is the actual outcome for the <span class="math notranslate nohighlight">\(i\)</span>-th observation (<cite>0</cite> or <cite>1</cite>).</p></li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="eval_kfre_metrics">
<span class="sig-name descname"><span class="pre">eval_kfre_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_var_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outcome_years</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_places</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#eval_kfre_metrics" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>DataFrame</em>) – The input DataFrame containing the necessary columns for truth and predictions. Rows with NaN values will be dropped.</p></li>
<li><p><strong>n_var_list</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em> of </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – List of variable numbers to consider, e.g., <code class="docutils literal notranslate"><span class="pre">[4,</span> <span class="pre">6,</span> <span class="pre">8]</span></code>.</p></li>
<li><p><strong>outcome_years</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><em>tuple</em></a><em>, or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – (<cite>optional</cite>) List, tuple, or single year to consider for outcomes. Default is <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">5]</span></code>.</p></li>
<li><p><strong>decimal_places</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><em>int</em></a>) – (<cite>optional</cite>) Number of decimal places for the calculated metrics. Default is <code class="docutils literal notranslate"><span class="pre">6</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code>: A DataFrame containing the calculated metrics for each outcome.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">ValueError</span></code>: If required outcome columns are missing in the DataFrame.
<code class="docutils literal notranslate"><span class="pre">ValueError</span></code>: If an invalid variable number is provided in <code class="docutils literal notranslate"><span class="pre">n_var_list</span></code>.</p>
</dd>
</dl>
<p>This function computes a set of performance metrics for multiple binary classification models given the true labels and the predicted probabilities for each outcome. The metrics calculated include precision (positive predictive value), average precision, sensitivity (recall), specificity, AUC ROC, and Brier score.</p>
<dl class="simple">
<dt>Notes:</dt><dd><ul class="simple">
<li><p>Precision is calculated with a threshold of <cite>0.5</cite> for the predicted probabilities.</p></li>
<li><p>Sensitivity is also known as recall.</p></li>
<li><p>Specificity is calculated as the recall for the negative class.</p></li>
<li><p>AUC ROC is calculated using the receiver operating characteristic curve.</p></li>
<li><p>Brier score measures the mean squared difference between predicted probabilities and the true binary outcomes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p><strong>Example Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kfre</span> <span class="kn">import</span> <span class="n">eval_kfre_metrics</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metrics_df_n_var</span> <span class="o">=</span> <span class="n">eval_kfre_metrics</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>                 <span class="c1"># Metrics-ready DataFrame as the first argument</span>
    <span class="n">n_var_list</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>  <span class="c1"># Specify the list of variable numbers to consider</span>
    <span class="n">outcome_years</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>  <span class="c1"># Specify the list of outcome years to consider</span>
<span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>,<a role="doc-backlink" href="#id4">3</a>,<a role="doc-backlink" href="#id5">4</a>)</span>
<p>Ali, I., Donne, R. L., &amp; Kalra, P. A. (2021). A validation study of the kidney failure risk equation in advanced chronic kidney disease according to disease aetiology with evaluation of discrimination, calibration and clinical utility. <em>BMC Nephrology, 22(1),</em> 194. <a class="reference external" href="https://doi.org/10.1186/s12882-021-02402-1">https://doi.org/10.1186/s12882-021-02402-1</a></p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Welcome to the KFRE Python Library Documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="acknowledgements.html" class="btn btn-neutral float-right" title="Acknowledgements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Leonid Shpaner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>